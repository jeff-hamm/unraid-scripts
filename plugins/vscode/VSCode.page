Menu="Tasks:99"
Type="xmenu"
Tabs="false"
Icon="vscode.png"
Title="VS Code"
---
<?php
$docroot = $docroot ?? $_SERVER['DOCUMENT_ROOT'] ?: '/usr/local/emhttp';

// Get the folder path from query parameter, default to /root
$folder = isset($_GET['folder']) ? $_GET['folder'] : '/root';

// Get all user shares
$shares = [];
if (is_dir('/mnt/user')) {
    $dirs = scandir('/mnt/user');
    foreach ($dirs as $dir) {
        if ($dir !== '.' && $dir !== '..' && is_dir('/mnt/user/' . $dir)) {
            $shares[] = $dir;
        }
    }
}
?>

<style>
#vscode-container {
    position: relative;
    width: 100%;
    height: calc(100vh - 120px);
    min-height: 600px;
    border: none;
    border-radius: 4px;
    overflow: hidden;
    background: #1e1e1e;
}

#vscode-frame {
    width: 100%;
    height: 100%;
    border: none;
}

.vscode-toolbar {
    width: 100%;
    height: 60px;
    background: #1e1e1e;
    border-bottom: 1px solid #333;
    display: flex;
    align-items: center;
    padding: 0 20px;
    box-sizing: border-box;
}

.vscode-toolbar label {
    color: #ccc;
    margin-right: 10px;
    font-size: 14px;
}

.vscode-toolbar select {
    background: #3c3c3c;
    border: 1px solid #555;
    color: #fff;
    padding: 8px 12px;
    border-radius: 4px;
    width: 300px;
    font-size: 14px;
}
</style>

<div class="vscode-toolbar">
    <label for="folderSelect">Folder:</label>
    <select id="folderSelect" onchange="changeFolder()">
        <option value="/root" <?=($folder === '/root' ? 'selected' : '')?>>System (/root)</option>
        <?php foreach ($shares as $share): ?>
            <option value="/mnt/user/<?=htmlspecialchars($share)?>" 
                    <?=($folder === "/mnt/user/$share" ? 'selected' : '')?>>
                <?=htmlspecialchars($share)?>
            </option>
        <?php endforeach; ?>
    </select>
</div>

<div id="vscode-container">
    <iframe id="vscode-frame" src="/vscode-server/?folder=<?=urlencode($folder)?>" allow="clipboard-read; clipboard-write"></iframe>
</div>

<script>
function changeFolder() {
    var folder = document.getElementById('folderSelect').value;
    document.getElementById('vscode-frame').src = '/vscode-server/?folder=' + encodeURIComponent(folder);
}
</script>
