#compdef dc-rebuild

# Completion for dc-rebuild function - lists docker-compose services
_dc-rebuild() {
    local curcontext="$curcontext" state line
    typeset -A opt_args

    # Try to find docker-compose.yml in current directory or parent
    local compose_file=""
    local search_dir="$PWD"
    
    while [[ "$search_dir" != "/" ]]; do
        if [[ -f "$search_dir/docker-compose.yml" ]]; then
            compose_file="$search_dir/docker-compose.yml"
            break
        elif [[ -f "$search_dir/docker-compose.yaml" ]]; then
            compose_file="$search_dir/docker-compose.yaml"
            break
        fi
        search_dir="${search_dir:h}"
    done

    if [[ -n "$compose_file" ]]; then
        # Extract service names from docker-compose.yml
        local -a services
        services=(${(f)"$(docker-compose config --services 2>/dev/null)"})
        
        if (( ${#services[@]} > 0 )); then
            _describe 'service' services
            return 0
        fi
    fi

    # Fallback: allow any input
    _message 'service name'
}

_dc-rebuild "$@"
